<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>resumer-element</title>

    <!-- Import dependencies -->
    <script src="../../webcomponentsjs/webcomponents.min.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../../polymer/polymer.html">
    <link rel="import" href="../ugo-fieldset.html">
    <link rel="import" href="../../ugo-resumer/ugo-resumer.html">
    <link rel="import" href="../../core-collapse/core-collapse.html">
    <link rel="stylesheet" href="../other.css">
</head>

<body>

<form id="form">
<ugo-fieldset id="typical" preventSubmission legend="Main">
    <ugo-resumer id="rsm" showed class="ugo-fieldset-resume" attribute="{{attribute}}">
        <core-collapse opened="{{opened}}" allowOverflow class="ugo-fieldset-content">
            <div class="core-collapse-container">
                <p><input type="hidden" name="hidden" resumer-item value="hidden" /></p>
                <p><input type="text" name="text1" resumer-item pattern="text1" value="text" /></p>
                <p><select name="select" resumer-item>
                    <option value="select" selected="selected">select</option>
                </select></p>


                <p><input type="text" name="text2" resumer-item required="required" value="" /></p>
                <p><select name="select2" resumer-item>
                    <option value="select2" selected="selected">select2</option>
                </select></p>
            </div>
        </core-collapse>
    </ugo-resumer>
</ugo-fieldset>

    <ugo-fieldset id="test2" preventSubmission legend="Main2">
        <ugo-resumer id="rsm" showed class="ugo-fieldset-resume" attribute="{{attribute}}">
            <core-collapse opened="{{opened}}" allowOverflow class="ugo-fieldset-content">
                <div class="core-collapse-container">
                     <input type="text" name="text3" resumer-item pattern="text" value="text" />
                </div>
            </core-collapse>
        </ugo-resumer>
    </ugo-fieldset>
</form>

<script>
    suite('<ugo-fieldset>', function() {
        var el = document.getElementById('typical'),
            resume = el.querySelector('ugo-resumer'),
            collapse = el.querySelector('core-collapse');

        test('exists', function() {
            assert.isNotNull(el);
        });

        test('it is opening when there is errors', function(done) {
            assert.isTrue(resume.showed);
            assert.isFalse(collapse.opened);
            setTimeout(function() {
                el.onFormSubmit({preventDefault: function() {}});
                setTimeout(function() {
                    assert.isFalse(resume.showed);
                    assert.isTrue(collapse.opened);
                    done();
                }, 400);
            }, 100);
        });

        var test2 = document.getElementById('test2'),
            resume2 = test2.querySelector('ugo-resumer'),
            collapse2 = test2.querySelector('core-collapse');

        test('it is not opening when there is no error', function(done) {
            assert.isTrue(resume2.showed);
            assert.isFalse(collapse2.opened);
            setTimeout(function() {
                test2.onFormSubmit({preventDefault: function() {}});
                setTimeout(function() {
                    assert.isTrue(resume2.showed);
                    assert.isFalse(collapse2.opened);
                    done();
                }, 400);
            }, 100);
        });

    });
</script>

</body>
</html>